<!-- Generated by SpecStory -->

# Launch Control XL3 Package Update: SysEx Fix (2025-09-28 23:51:57Z)

<!-- Claude Code Session 38732689-581a-4ca0-a169-2b9f19aa276f (2025-09-28_23-51-57Z) -->

_**User**_

Analyze these staged git changes and output ONLY a single-line conventional commit message (type(scope): description). No explanations.
diff --git a/.playwright-mcp/device_connected_state.png b/.playwright-mcp/device_connected_state.png
new file mode 100644
index 0000000..6e1fd73
Binary files /dev/null and b/.playwright-mcp/device_connected_state.png differ
diff --git a/.playwright-mcp/fetch_button_issue_initial_state.png b/.playwright-mcp/fetch_button_issue_initial_state.png
new file mode 100644
index 0000000..a4fa84a
Binary files /dev/null and b/.playwright-mcp/fetch_button_issue_initial_state.png differ
diff --git a/.playwright-mcp/fetch_timeout_error.png b/.playwright-mcp/fetch_timeout_error.png
new file mode 100644
index 0000000..6e1fd73
Binary files /dev/null and b/.playwright-mcp/fetch_timeout_error.png differ
diff --git a/WORKPLAN-FETCH-MODE.md b/WORKPLAN-FETCH-MODE.md
index 90a0d7a..4c9e87b 100644
--- a/WORKPLAN-FETCH-MODE.md
+++ b/WORKPLAN-FETCH-MODE.md
@@ -1,6 +1,6 @@
 # Fetch Mode from Device Implementation Workplan
 
-**Status**: 🟡 IN PROGRESS
+**Status**: ⚠️ BLOCKED BY LIBRARY BUG
 **Date**: 2025-09-27
 **Feature**: Feature 6.0 & 6.1 - Send and Receive Modes to and from Device (Fetch Only)
 
@@ -19,7 +19,7 @@
 ## Current State Analysis
 
 ### What EXISTS:
-- ✅ @oletizi/launch-control-xl3 package (v1.0.12) with LaunchControlXL3 class
+- ✅ @oletizi/launch-control-xl3 package (v1.1.0) with Web MIDI API support
 - ✅ MIDIConnectionManager for basic MIDI connection (Feature 1)
 - ✅ useMIDIDevice hook that tracks connection state
 - ✅ Editor page with mode state and Send button
@@ -410,8 +410,51 @@ Full integration testing will require hardware.
 - **Hardware Dependency**: Full feature testing requires physical LCXL3 hardware
 - **Slot Selection**: Currently fetches slot 0 (active mode). Future enhancement could allow slot selection.
 - **Send Feature (6.2)**: Not implemented in this workplan. Will be separate implementation.
-- **Library Integration**: Uses @oletizi/launch-control-xl3 v1.0.12 which provides comprehensive MIDI SysEx support
+- **Library Integration**: Uses @oletizi/launch-control-xl3 v1.1.0 which provides Web MIDI API support and comprehensive MIDI SysEx support
 
 ---
 
-**Next Step**: Begin Task 2 (Create mode converter utility)
\ No newline at end of file
+## ⚠️ BLOCKER: Library Bug Discovered
+
+**Date**: 2025-09-27
+**Issue**: https://github.com/oletizi/ol_dsp/issues/13
+
+### Problem
+
+The `@oletizi/launch-control-xl3` v1.1.0 library's `loadCustomMode()` method does not send SysEx messages to the device when using the Web MIDI backend.
+
+### Evidence
+
+- Device connects and handshakes successfully
+- `device.isConnected()` returns `true`
+- Clicking Fetch button calls `device.loadCustomMode(0)` correctly
+- **NO SysEx message sent to device** (confirmed with MIDI monitor)
+- Times out after ~3 seconds with "Custom mode read timeout"
+
+### Expected SysEx Message (not sent)
+
+```
+F0 00 20 29 02 11 [command] [slot] F7
+```
+
+### Implementation Status
+
+✅ **Our implementation is complete:**
+- Task 1: `useLCXL3Device` hook ✅
+- Task 2: Mode converter utility ✅
+- Task 3: Fetch button UI ✅
+- Task 4: Control ID mapping ✅
+- Task 6: E2E tests ✅
+
+❌ **Blocked by library:**
+- Task 5: Hardware verification (blocked - library bug prevents MIDI communication)
+
+### Next Steps
+
+1. Wait for library author to fix `loadCustomMode()` in Web MIDI backend
+2. Test with fixed library version
+3. Complete Task 5 verification
+
+---
+
+**Implementation Complete** - Blocked by upstream library bug
\ No newline at end of file
diff --git a/package.json b/package.json
index b5ea518..b7bf3a8 100644
--- a/package.json
+++ b/package.json
@@ -17,7 +17,7 @@
   },
   "dependencies": {
     "@hookform/resolvers": "^3.10.0",
-    "@oletizi/launch-control-xl3": "^1.1.0",
+    "@oletizi/launch-control-xl3": "^1.6.0",
     "@radix-ui/react-accordion": "^1.2.11",
     "@radix-ui/react-alert-dialog": "^1.1.14",
     "@radix-ui/react-aspect-ratio": "^1.1.7",
diff --git a/pnpm-lock.yaml b/pnpm-lock.yaml
index c368df5..3f833c3 100644
--- a/pnpm-lock.yaml
+++ b/pnpm-lock.yaml
@@ -12,8 +12,8 @@ importers:
         specifier: ^3.10.0
         version: 3.10.0(react-hook-form@7.63.0(react@18.3.1))
       '@oletizi/launch-control-xl3':
-        specifier: ^1.1.0
-        version: 1.1.0(@types/node@22.18.6)
+        specifier: ^1.6.0
+        version: 1.6.0(@types/node@22.18.6)
       '@radix-ui/react-accordion':
         specifier: ^1.2.11
         version: 1.2.12(@types/react-dom@18.3.7(@types/react@18.3.24))(@types/react@18.3.24)(react-dom@18.3.1(react@18.3.1))(react@18.3.1)
@@ -618,9 +618,6 @@ packages:
     resolution: {integrity: sha512-bV0Tgo9K4hfPCek+aMAn81RppFKv2ySDQeMoSZuvTASywNTnVJCArCZE2FWqpvIatKu7VMRLWlR1EazvVhDyhQ==}
     engines: {node: '>=18.18'}
 
-  '@hypersphere/omnibus@0.1.6':
-    resolution: {integrity: sha512-agZuKyhdW0n1JoLYZUuA6Du1QoQn39/LapFgRtbJs7fyRM62C9O2PWISHUCwAKnC1Splshpd8glQgx5pA2zkCg==}
-
   '@inquirer/external-editor@1.0.2':
     resolution: {integrity: sha512-yy9cOoBnx58TlsPrIxauKIFQTiyH+0MK4e97y4sV9ERbI+zDxw7i2hxHLCIEGIE/8PPvDxGhgzIOTSOWcs6/MQ==}
     engines: {node: '>=18'}
@@ -651,9 +648,6 @@ packages:
   '@jridgewell/trace-mapping@0.3.31':
     resolution: {integrity: sha512-zzNR+SdQSDJzc8joaeP8QQoCQr8NuYx2dIIytl1QeBEZHJ9uW6hebsrYgbz8hJwUQao3TWCMtmfV8Nu1twOLAw==}
 
-  '@midival/core@0.2.0':
-    resolution: {integrity: sha512-BmF2yhXo4iGDu1ZbkU50kS+CoBVkTzeDgljKAjFIUlJdszWLpVo5te3zImb0GB6ZyjMvjN+PmZE9g5rMokmL0w==}
-
   '@nodelib/fs.scandir@2.1.5':
     resolution: {integrity: sha512-vq24Bq3ym5HEQm2NKCr3yXDwjc7vTsEThRDnkp2DK9p1uqLR+DHurm/NOTo0KG7HYHU7eppKZj3MyqYuMBf62g==}
     engines: {node: '>= 8'}
@@ -666,8 +660,8 @@ packages:
     resolution: {integrity: sha512-oGB+UxlgWcgQkgwo8GcEGwemoTFt3FIO9ababBmaGwXIoBKZ+GTy0pP185beGg7Llih/NSHSV2XAs1lnznocSg==}
     engines: {node: '>= 8'}
 
-  '@oletizi/launch-control-xl3@1.1.0':
-    resolution: {integrity: sha512-ZJy/wXh2tPLuUq/C+gARuzxiZKXYnPbWygCxT5pxYdc1Oo3sDvCuS5BRjw5BrDcd6ZQy3soTh0Ax1hsWSjjoYw==}
+  '@oletizi/launch-control-xl3@1.6.0':
+    resolution: {integrity: sha512-jGsheBmnhW/s16nB5uSQpXIKPpZWG/BYXJ60/bEJWUgHf7ZBog957U5oNdbgUqRw0bEPexBjtx5TF75Hf5SkTQ==}
     engines: {node: '>=18'}
     hasBin: true
     peerDependencies:
@@ -3212,8 +3206,6 @@ snapshots:
 
   '@humanwhocodes/retry@0.4.3': {}
 
-  '@hypersphere/omnibus@0.1.6': {}
-
   '@inquirer/external-editor@1.0.2(@types/node@22.18.6)':
     dependencies:
       chardet: 2.1.0
@@ -3246,10 +3238,6 @@ snapshots:
       '@jridgewell/resolve-uri': 3.1.2
       '@jridgewell/sourcemap-codec': 1.5.5
 
-  '@midival/core@0.2.0':
-    dependencies:
-      '@hypersphere/omnibus': 0.1.6
-
   '@nodelib/fs.scandir@2.1.5':
     dependencies:
       '@nodelib/fs.stat': 2.0.5
@@ -3262,9 +3250,8 @@ snapshots:
       '@nodelib/fs.scandir': 2.1.5
       fastq: 1.19.1
 
-  '@oletizi/launch-control-xl3@1.1.0(@types/node@22.18.6)':
+  '@oletizi/launch-control-xl3@1.6.0(@types/node@22.18.6)':
     dependencies:
-      '@midival/core': 0.2.0
       '@types/js-yaml': 4.0.9
       chalk: 5.6.2
       commander: 11.1.0
diff --git a/src/hooks/useLCXL3Device.ts b/src/hooks/useLCXL3Device.ts
index db7b8a4..7a8e320 100644
--- a/src/hooks/useLCXL3Device.ts
+++ b/src/hooks/useLCXL3Device.ts
@@ -1,36 +1,111 @@
 import { useState, useEffect } from 'react';
-import { useMIDIDevice } from '@/hooks/useMIDIDevice';
-import type { LCXL3CustomMode, LCXL3Control } from '@/utils/modeConverter';
+import { LaunchControlXL3 } from '@oletizi/launch-control-xl3';
+import type { LCXL3CustomMode } from '@/utils/modeConverter';
 
 export interface LCXL3DeviceState {
+  device: LaunchControlXL3 | null;
   isConnected: boolean;
   isInitialized: boolean;
   error: string | null;
 }
 
 export function useLCXL3Device() {
-  const midiState = useMIDIDevice();
+  // Create device instance once (following library README pattern)
+  const [device] = useState(() => {
+    console.log('[useLCXL3Device] Creating LaunchControlXL3 instance');
+    return new LaunchControlXL3({
+      autoConnect: true,
+      enableCustomModes: true,
+      enableLedControl: false
+    });
+  });
 
   const [state, setState] = useState<LCXL3DeviceState>({
+    device,
     isConnected: false,
     isInitialized: false,
     error: null
   });
 
   useEffect(() => {
-    setState({
-      isConnected: midiState.isConnected,
-      isInitialized: midiState.isInitialized,
-      error: midiState.error
-    });
-  }, [midiState.isConnected, midiState.isInitialized, midiState.error]);
+    console.log('[useLCXL3Device] Setting up event listeners');
+
+    const handleConnected = () => {
+      console.log('[useLCXL3Device] Device connected event');
+      setState(prev => ({ ...prev, isConnected: true }));
+    };
+
+    const handleReady = () => {
+      console.log('[useLCXL3Device] Device ready event');
+      setState(prev => ({ ...prev, isConnected: true }));
+    };
+
+    const handleDisconnected = () => {
+      console.log('[useLCXL3Device] Device disconnected event');
+      setState(prev => ({ ...prev, isConnected: false }));
+    };
+
+    const handleError = (error: Error) => {
+      console.error('[useLCXL3Device] Device error:', error);
+      setState(prev => ({
+        ...prev,
+        error: error.message || 'Device error',
+        isConnected: false
+      }));
+    };
+
+    device.on('device:connected', handleConnected);
+    device.on('device:ready', handleReady);
+    device.on('device:disconnected', handleDisconnected);
+    device.on('device:error', handleError);
+
+    const initDevice = async () => {
+      try {
+        console.log('[useLCXL3Device] Initializing device...');
+        await device.initialize();
+        console.log('[useLCXL3Device] Device initialized, isConnected:', device.isConnected());
+
+        setState(prev => ({
+          ...prev,
+          isConnected: device.isConnected(),
+          isInitialized: true,
+          error: null
+        }));
+      } catch (error) {
+        console.error('[useLCXL3Device] Initialization error:', error);
+        setState(prev => ({
+          ...prev,
+          error: error instanceof Error ? error.message : 'Failed to initialize device',
+          isInitialized: true
+        }));
+      }
+    };
+
+    initDevice();
+
+    return () => {
+      console.log('[useLCXL3Device] Cleaning up');
+      device.off('device:connected', handleConnected);
+      device.off('device:ready', handleReady);
+      device.off('device:disconnected', handleDisconnected);
+      device.off('device:error', handleError);
+      device.cleanup().catch(console.error);
+    };
+  }, [device]);
 
   const fetchCurrentMode = async (): Promise<LCXL3CustomMode> => {
-    if (!midiState.xl3Device || !midiState.isConnected) {
+    console.log('[fetchCurrentMode] Starting fetch, isConnected:', state.isConnected);
+    console.log('[fetchCurrentMode] Device instance:', device);
+    console.log('[fetchCurrentMode] Device.isConnected():', device?.isConnected());
+
+    if (!device || !state.isConnected) {
       throw new Error('Device not connected');
     }
 
-    throw new Error('Fetch mode not yet implemented - requires SysEx protocol implementation');
+    console.log('[fetchCurrentMode] Calling device.loadCustomMode(0)...');
+    const mode = await device.loadCustomMode(0);
+    console.log('[fetchCurrentMode] Mode loaded:', mode);
+    return mode;
   };
 
   return {
diff --git a/src/utils/modeConverter.ts b/src/utils/modeConverter.ts
index 14bb826..d48824e 100644
--- a/src/utils/modeConverter.ts
+++ b/src/utils/modeConverter.ts
@@ -1,8 +1,12 @@
 import type { CustomMode, ControlMapping } from '@/types/mode';
 
+/**
+ * LCXL3 Control mapping format from @oletizi/launch-control-xl3 library
+ */
 export interface LCXL3Control {
   controlId: number;
-  type?: string;
+  type?: 'knob' | 'fader' | 'button';
+  controlType?: 'knob' | 'fader' | 'button';
   midiChannel?: number;
   channel?: number;
   ccNumber?: number;
@@ -11,75 +15,104 @@ export interface LCXL3Control {
   min?: number;
   maxValue?: number;
   max?: number;
-  behavior?: string;
+  behavior?: 'absolute' | 'relative' | 'toggle';
   behaviour?: string;
+  transform?: string | ((value: number) => number);
 }
 
+/**
+ * LCXL3 Mode format from @oletizi/launch-control-xl3 library
+ */
 export interface LCXL3CustomMode {
   name: string;
   controls: Record<string, LCXL3Control> | LCXL3Control[];
+  labels?: Map<number, string>;
+  colors?: Map<number, number>;
   leds?: Map<number, { color: number | string; behaviour: string }>;
   metadata?: {
+    name?: string;
+    description?: string;
+    version?: string;
     slot?: number;
     createdAt?: Date;
     modifiedAt?: Date;
+    [key: string]: any;
   };
 }
 
+/**
+ * Complete mapping between LCXL3 control IDs (hex values) and our control ID format
+ * Based on CONTROL_IDS from @oletizi/launch-control-xl3/src/modes/CustomModeManager.ts
+ *
+ * LCXL3 Hardware Layout:
+ * - Send A knobs (top row): 8 knobs
+ * - Send B knobs (middle row): 8 knobs
+ * - Pan/Device knobs (bottom row): 8 knobs
+ * - Faders: 8 faders
+ * - Focus buttons: 8 buttons
+ * - Control buttons: 8 buttons
+ * Total: 48 controls
+ */
 const LCXL3_TO_APP_CONTROL_MAP: Record<number, string> = {
-  0x0D: 'knob-cc13',
-  0x0E: 'knob-cc14',
-  0x0F: 'knob-cc15',
-  0x10: 'knob-cc16',
-  0x11: 'knob-cc17',
-  0x12: 'knob-cc18',
-  0x13: 'knob-cc19',
-  0x14: 'knob-cc20',
-
-  0x1D: 'knob-cc29',
-  0x1E: 'knob-cc30',
-  0x1F: 'knob-cc31',
-  0x20: 'knob-cc32',
-  0x21: 'knob-cc33',
-  0x22: 'knob-cc22',
-  0x23: 'knob-cc23',
-  0x24: 'knob-cc24',
-
-  0x31: 'knob-cc49',
-  0x32: 'knob-cc50',
-  0x33: 'knob-cc51',
-  0x34: 'knob-cc52',
-  0x35: 'knob-cc53',
-  0x36: 'knob-cc25',
-  0x37: 'knob-cc26',
-  0x38: 'knob-cc27',
-
-  0x4D: 'fader-cc5',
-  0x4E: 'fader-cc6',
-  0x4F: 'fader-cc7',
-  0x50: 'fader-cc8',
-  0x51: 'fader-cc9',
-  0x52: 'fader-cc10',
-  0x53: 'fader-cc11',
-  0x54: 'fader-cc12',
-
-  0x29: 'button-cc41',
-  0x2A: 'button-cc42',
-  0x2B: 'button-cc43',
-  0x2C: 'button-cc44',
-  0x2D: 'button-cc45',
-  0x2E: 'button-cc46',
-  0x2F: 'button-cc47',
-  0x30: 'button-cc48',
-
-  0x39: 'button-cc37',
-  0x3A: 'button-cc38',
-  0x3B: 'button-cc39',
-  0x3C: 'button-cc40',
-  0x3D: 'button-cc49',
-  0x3E: 'button-cc50',
-  0x3F: 'button-cc51',
-  0x40: 'button-cc52',
+  // Send A knobs (top row) - CC 13-20 (8 knobs)
+  0x0D: 'knob-cc13',  // SEND_A1
+  0x0E: 'knob-cc14',  // SEND_A2
+  0x0F: 'knob-cc15',  // SEND_A3
+  0x10: 'knob-cc16',  // SEND_A4
+  0x11: 'knob-cc17',  // SEND_A5
+  0x12: 'knob-cc18',  // SEND_A6
+  0x13: 'knob-cc19',  // SEND_A7
+  0x14: 'knob-cc20',  // SEND_A8
+
+  // Send B knobs (middle row) - CC 29-36 (8 knobs)
+  0x1D: 'knob-cc29',  // SEND_B1
+  0x1E: 'knob-cc30',  // SEND_B2
+  0x1F: 'knob-cc31',  // SEND_B3
+  0x20: 'knob-cc32',  // SEND_B4
+  0x21: 'knob-cc33',  // SEND_B5
+  0x22: 'knob-cc34',  // SEND_B6
+  0x23: 'knob-cc35',  // SEND_B7
+  0x24: 'knob-cc36',  // SEND_B8
+
+  // Pan/Device knobs (bottom row) - CC 22-28, 53 (8 knobs)
+  0x31: 'knob-cc22',  // PAN1
+  0x32: 'knob-cc23',  // PAN2
+  0x33: 'knob-cc24',  // PAN3
+  0x34: 'knob-cc25',  // PAN4
+  0x35: 'knob-cc26',  // PAN5
+  0x36: 'knob-cc27',  // PAN6
+  0x37: 'knob-cc28',  // PAN7
+  0x38: 'knob-cc53',  // PAN8
+
+  // Faders - CC 5-12 (8 faders)
+  0x4D: 'fader-cc5',  // FADER1
+  0x4E: 'fader-cc6',  // FADER2
+  0x4F: 'fader-cc7',  // FADER3
+  0x50: 'fader-cc8',  // FADER4
+  0x51: 'fader-cc9',  // FADER5
+  0x52: 'fader-cc10', // FADER6
+  0x53: 'fader-cc11', // FADER7
+  0x54: 'fader-cc12', // FADER8
+
+  // Track focus buttons - CC 41-48 (8 buttons)
+  0x29: 'button-cc41', // FOCUS1
+  0x2A: 'button-cc42', // FOCUS2
+  0x2B: 'button-cc43', // FOCUS3
+  0x2C: 'button-cc44', // FOCUS4
+  0x2D: 'button-cc45', // FOCUS5
+  0x2E: 'button-cc46', // FOCUS6
+  0x2F: 'button-cc47', // FOCUS7
+  0x30: 'button-cc48', // FOCUS8
+
+  // Track control buttons - CC 37-40, 49-52 (8 buttons)
+  0x39: 'button-cc37', // CONTROL1
+  0x3A: 'button-cc38', // CONTROL2
+  0x3B: 'button-cc39', // CONTROL3
+  0x3C: 'button-cc40', // CONTROL4
+  0x3D: 'button-cc49', // CONTROL5
+  0x3E: 'button-cc50', // CONTROL6
+  0x3F: 'button-cc51', // CONTROL7
+  0x40: 'button-cc52', // CONTROL8
 };
 
 export function lcxl3ModeToCustomMode(lcxl3Mode: LCXL3CustomMode): CustomMode {
@@ -117,7 +150,7 @@ export function lcxl3ModeToCustomMode(lcxl3Mode: LCXL3CustomMode): CustomMode {
       id: ourControlId,
       type: controlType,
       ccNumber,
-      midiChannel: midiChannel + 1,
+      midiChannel,
       minValue,
       maxValue,
       label: ''
@@ -132,4 +165,110 @@ export function lcxl3ModeToCustomMode(lcxl3Mode: LCXL3CustomMode): CustomMode {
     createdAt: lcxl3Mode.metadata?.createdAt?.toISOString() || new Date().toISOString(),
     modifiedAt: new Date().toISOString()
   };
+}
+
+/**
+ * Reverse mapping from our control IDs to LCXL3 control hex IDs
+ */
+const APP_TO_LCXL3_CONTROL_MAP: Record<string, number> = Object.fromEntries(
+  Object.entries(LCXL3_TO_APP_CONTROL_MAP).map(([lcxl3Id, ourId]) => [ourId, parseInt(lcxl3Id)])
+);
+
+/**
+ * Convert our CustomMode format to LCXL3 mode format
+ * This function may be useful for sending modes to the device in the future
+ */
+export function customModeToLCXL3Mode(customMode: CustomMode): LCXL3CustomMode {
+  const controls: Record<string, LCXL3Control> = {};
+  const labels = new Map<number, string>();
+
+  // Process each control mapping from our custom mode
+  for (const [ourControlId, control] of Object.entries(customMode.controls)) {
+    const lcxl3ControlId = APP_TO_LCXL3_CONTROL_MAP[ourControlId];
+    if (!lcxl3ControlId) {
+      console.warn(`No LCXL3 mapping found for control ID: ${ourControlId}`);
+      continue;
+    }
+
+    const controlKey = `control_${lcxl3ControlId.toString(16).padStart(2, '0').toUpperCase()}`;
+
+    controls[controlKey] = {
+      controlId: lcxl3ControlId,
+      type: control.type,
+      midiChannel: control.midiChannel,
+      ccNumber: control.ccNumber,
+      minValue: control.minValue,
+      maxValue: control.maxValue,
+      behavior: 'absolute'
+    };
+
+    // Add label to labels map if provided
+    if (control.label) {
+      labels.set(lcxl3ControlId, control.label);
+    }
+  }
+
+  return {
+    name: customMode.name.substring(0, 8), // LCXL3 names limited to 8 chars
+    controls,
+    labels,
+    metadata: {
+      name: customMode.name,
+      description: customMode.description,
+      version: customMode.version
+    }
+  };
+}
+
+/**
+ * Get all supported LCXL3 control hex IDs
+ */
+export function getAllLCXL3ControlIds(): number[] {
+  return Object.keys(LCXL3_TO_APP_CONTROL_MAP).map(hex => parseInt(hex));
+}
+
+/**
+ * Get all our control IDs that map to LCXL3 controls
+ */
+export function getAllMappedControlIds(): string[] {
+  return Object.values(LCXL3_TO_APP_CONTROL_MAP);
+}
+
+/**
+ * Check if a control ID is supported for LCXL3 conversion
+ */
+export function isControlIdMapped(controlId: string): boolean {
+  return controlId in APP_TO_LCXL3_CONTROL_MAP;
+}
+
+/**
+ * Get the LCXL3 control hex ID for our control ID
+ */
+export function getLCXL3ControlId(ourControlId: string): number | null {
+  return APP_TO_LCXL3_CONTROL_MAP[ourControlId] ?? null;
+}
+
+/**
+ * Get our control ID for an LCXL3 control hex ID
+ */
+export function getOurControlId(lcxl3ControlId: number): string | null {
+  return LCXL3_TO_APP_CONTROL_MAP[lcxl3ControlId] ?? null;
+}
+
+/**
+ * Get control mapping statistics
+ */
+export function getControlMappingStats() {
+  const totalControls = Object.keys(LCXL3_TO_APP_CONTROL_MAP).length;
+  const knobControls = Object.values(LCXL3_TO_APP_CONTROL_MAP).filter(id => id.startsWith('knob-')).length;
+  const faderControls = Object.values(LCXL3_TO_APP_CONTROL_MAP).filter(id => id.startsWith('fader-')).length;
+  const buttonControls = Object.values(LCXL3_TO_APP_CONTROL_MAP).filter(id => id.startsWith('button-')).length;
+
+  return {
+    total: totalControls,
+    knobs: knobControls,
+    faders: faderControls,
+    buttons: buttonControls,
+    expectedTotal: 48 // 24 knobs + 8 faders + 16 buttons
+  };
 }
\ No newline at end of file
diff --git a/vite.config.ts b/vite.config.ts
index da25c6d..04d171b 100644
--- a/vite.config.ts
+++ b/vite.config.ts
@@ -15,4 +15,12 @@ export default defineConfig(({ mode }) => ({
       "@": path.resolve(__dirname, "./src"),
     },
   },
+  build: {
+    rollupOptions: {
+      external: ['module', 'fs', 'path'],
+    },
+  },
+  define: {
+    global: 'globalThis',
+  },
 }));


---

_**Agent (claude-opus-4-1-20250805)**_

feat: update library and add E2E test screenshots

